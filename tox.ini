[tox]
envlist = py{39,310,311}, lint, security, docs
isolated_build = true

[testenv]
deps = 
    -r{toxinidir}/requirements-dev.txt
commands = 
    pytest {posargs:tests/} --cov=neural_operator_lab --cov-report=term-missing --cov-report=html

[testenv:lint]
deps = 
    black
    isort
    flake8
    mypy
    types-all
commands = 
    black --check --diff src/ tests/
    isort --check-only --diff src/ tests/
    flake8 src/ tests/
    mypy src/neural_operator_lab/

[testenv:security]
deps = 
    bandit
    safety
commands = 
    bandit -r src/ -f json -o bandit-report.json
    safety check --json --output safety-report.json

[testenv:docs]
deps = 
    sphinx
    sphinx-rtd-theme
    myst-parser
changedir = docs
commands = 
    sphinx-build -W -b html . _build/html

[testenv:performance]
deps = 
    {[testenv]deps}
    pytest-benchmark
commands = 
    pytest {posargs:tests/} -m "not slow" --benchmark-only

[testenv:integration]
deps = 
    {[testenv]deps}
commands = 
    pytest {posargs:tests/} -m integration

[flake8]
max-line-length = 88
extend-ignore = E203, W503
exclude = 
    .git,
    __pycache__,
    .venv,
    .tox,
    build,
    dist,
    docs/_build

[coverage:run]
source = src/neural_operator_lab
omit = 
    */tests/*
    */test_*

[coverage:report]
exclude_lines = 
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.: